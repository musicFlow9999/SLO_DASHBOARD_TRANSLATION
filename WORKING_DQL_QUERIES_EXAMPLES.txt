// Availability % = (total - failed) / total * 100
timeseries { total = sum(dt.service.request.count) },
  by:{ dt.entity.service },
  filter:{ in(dt.entity.service, array($Services)) }
| join [
    timeseries { failed = sum(dt.service.request.count, default: 0.0) },
      by:{ dt.entity.service },
      filter:{ failed == true and in(dt.entity.service, array($Services)) }
  ],
  kind:leftOuter,
  on:{ dt.entity.service, timeframe, interval },
  prefix:"err."
| fieldsAdd availability_pct = (total[] - err.failed[]) / total[] * 100
| fieldsAdd service = entityName(dt.entity.service)
| fields service, availability_pct, timeframe, interval


------------------------




timeseries {
  total    = sum(dt.service.request.count),
  failures = sum(dt.service.request.failure_count)
}, by: { dt.entity.service },
   filter: in(dt.entity.service, {"SERVICE-5704D468C6099AE4"})
| fieldsAdd
    total_sum    = arraySum(total),
    failures_sum = arraySum(failures)
| fieldsAdd availability_pct = if(total_sum > 0,
  100.0 * (total_sum - failures_sum) / total_sum,
  else: 0.0)
| fieldsAdd service_name = entityName(dt.entity.service)
| fieldsKeep service_name, dt.entity.service, availability_pct, total_sum, failures_sum